<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Getting Started With StackStorm and SaltStack | StackStorm</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="Guest post by Jurnell Cockhren, CTO and Founder of SophicWare
Our Journey
The task at hand is to connect Stackstorm to your pre-existing Saltstack infrastructure. Why? Well, by doing this you can turn all of your existing Salt actions into StackStorm actions, allowing you to use StackStorm for your overall event driven automation while Salt remains focused on remote execution and other use cases. This is a pattern we are increasingly seeing – so let’s try it out!
This blog covers both proper configuration of Saltstack NetAPI allowing for Stackstorm usage as well as how to install and configure the salt pack within StackStorm. This tutorial covers Scenario 2 listed on the Salt pack README.">
<meta name=generator content="Hugo 0.89.2">
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel=stylesheet href=/stackstorm.com/ananke/css/main.min.css>
<meta property="og:title" content="Getting Started With StackStorm and SaltStack">
<meta property="og:description" content="Guest post by Jurnell Cockhren, CTO and Founder of SophicWare
Our Journey
The task at hand is to connect Stackstorm to your pre-existing Saltstack infrastructure. Why? Well, by doing this you can turn all of your existing Salt actions into StackStorm actions, allowing you to use StackStorm for your overall event driven automation while Salt remains focused on remote execution and other use cases. This is a pattern we are increasingly seeing – so let’s try it out!
This blog covers both proper configuration of Saltstack NetAPI allowing for Stackstorm usage as well as how to install and configure the salt pack within StackStorm. This tutorial covers Scenario 2 listed on the Salt pack README.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://stackstorm.github.io/stackstorm.com/2015/07/29/getting-started-with-stackstorm-and-saltstack/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2015-07-29T13:23:55+00:00">
<meta property="article:modified_time" content="2015-07-29T13:23:55+00:00">
<meta itemprop=name content="Getting Started With StackStorm and SaltStack">
<meta itemprop=description content="Guest post by Jurnell Cockhren, CTO and Founder of SophicWare
Our Journey
The task at hand is to connect Stackstorm to your pre-existing Saltstack infrastructure. Why? Well, by doing this you can turn all of your existing Salt actions into StackStorm actions, allowing you to use StackStorm for your overall event driven automation while Salt remains focused on remote execution and other use cases. This is a pattern we are increasingly seeing – so let’s try it out!
This blog covers both proper configuration of Saltstack NetAPI allowing for Stackstorm usage as well as how to install and configure the salt pack within StackStorm. This tutorial covers Scenario 2 listed on the Salt pack README."><meta itemprop=datePublished content="2015-07-29T13:23:55+00:00">
<meta itemprop=dateModified content="2015-07-29T13:23:55+00:00">
<meta itemprop=wordCount content="697">
<meta itemprop=keywords content="tutorial,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Getting Started With StackStorm and SaltStack">
<meta name=twitter:description content="Guest post by Jurnell Cockhren, CTO and Founder of SophicWare
Our Journey
The task at hand is to connect Stackstorm to your pre-existing Saltstack infrastructure. Why? Well, by doing this you can turn all of your existing Salt actions into StackStorm actions, allowing you to use StackStorm for your overall event driven automation while Salt remains focused on remote execution and other use cases. This is a pattern we are increasingly seeing – so let’s try it out!
This blog covers both proper configuration of Saltstack NetAPI allowing for Stackstorm usage as well as how to install and configure the salt pack within StackStorm. This tutorial covers Scenario 2 listed on the Salt pack README.">
</head>
<body class="ma0 avenir bg-near-white">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=/stackstorm.com/ class="f3 fw2 hover-white no-underline white-90 dib">
StackStorm
</a>
<div class="flex-l items-center">
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
POSTS
</aside>
<div id=sharing class=mt3>
<a href="https://www.facebook.com/sharer.php?u=https://stackstorm.github.io/stackstorm.com/2015/07/29/getting-started-with-stackstorm-and-saltstack/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a>
<a href="https://twitter.com/share?url=https://stackstorm.github.io/stackstorm.com/2015/07/29/getting-started-with-stackstorm-and-saltstack/&text=Getting%20Started%20With%20StackStorm%20and%20SaltStack" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://stackstorm.github.io/stackstorm.com/2015/07/29/getting-started-with-stackstorm-and-saltstack/&title=Getting%20Started%20With%20StackStorm%20and%20SaltStack" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
</div>
<h1 class="f1 athelas mt3 mb1">Getting Started With StackStorm and SaltStack</h1>
<p class=tracked>
By <strong>
st2admin
</strong>
</p>
<time class="f6 mv4 dib tracked" datetime=2015-07-29T13:23:55Z>July 29, 2015</time>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p><em>Guest post by Jurnell Cockhren, CTO and Founder of <a href=http://sophicware.com/>SophicWare</a></em></p>
<h2 id=our-journey>Our Journey</h2>
<p>The task at hand is to connect Stackstorm to your pre-existing Saltstack infrastructure. Why? Well, by doing this you can turn all of your existing Salt actions into StackStorm actions, allowing you to use StackStorm for your overall event driven automation while Salt remains focused on remote execution and other use cases. This is a pattern we are increasingly seeing – so let’s try it out!</p>
<p>This blog covers both proper configuration of Saltstack NetAPI allowing for Stackstorm usage as well as how to install and configure the salt pack within StackStorm. This tutorial covers <a href=https://github.com/StackStorm-Exchange/stackstorm-salt#scenario-2-st2-using-salt-netapi>Scenario 2 listed on the Salt pack README</a>.</p>
<h3 id=minimum-requirements>Minimum Requirements</h3>
<ul>
<li>Saltstack (2014.7+)</li>
<li>a Stackstorm ready Vagrant (or VPS, if you’re courageous)</li>
</ul>
<h3 id=step-1-setup-netapi>Step 1. Setup NetAPI</h3>
<p>Saltstack’s NetAPI allows for remote execution of salt module functions. This feature proved most beneficial when developing deep integration between Stackstorm and Saltstack.</p>
<p>On your salt master, install the <code>salt-api</code> package using your typical means for updating or install Saltstack for your organization.</p>
<p>On Ubuntu, you could run:</p>
<p><code>apt-get install salt-api</code></p>
<p>Create a file named: <code>/etc/salt/master.d/salt-api.conf</code> filled with the following:</p>
<p>Let’s examine what’s what:</p>
<ul>
<li>
<p><code>port</code>: What port to have cherrypy listen on.</p>
</li>
<li>
<p><code>host</code>: The IP address of your interface to listen on. In production environments I like to not expose cherrypy directly to the world. Instead use nginx as the frontend allowing you to have more controls over the SSL ciphers and protocols.</p>
</li>
<li>
<p><code>debug</code>: Setting this to <code>True</code> is generally a good idea.</p>
</li>
<li>
<p><code>ssl_crt</code> and <code>ssl_key</code>: For this post, let’s allow cheerypy to handle SSL communications. Remember, use nginx for your frontend in production.</p>
</li>
</ul>
<h3 id=step-2-setup-access-control-list>Step 2: Setup Access Control List</h3>
<p>It makes good sense to be deliberate while choosing which users can authenticate with Saltstack and which modules they’re authorized to use. ACLs and <code>external_auth</code> are <a href=https://docs.saltstack.com/en/2014.7/ref/configuration/master.html#external-auth>outside the scope of this post</a>, but it pays off to know what is what during initial setup.</p>
<p>Suppose you have a non-root user called <code>stackstorm</code> that will be making the NetAPI on the behalf of stackstorm. Feel free to use <a href=https://docs.saltstack.com/en/2014.7/ref/auth/all/index.html>any supported external authenticaion backend</a>. In this example, we’re going with plain ol’ PAM.</p>
<p>Somewhere in your Saltstack master config add:</p>
<p>The above configuration allows your <code>stackstorm</code> user to execute:</p>
<ol>
<li>All runner functions.</li>
<li>All functions in the <code>test</code>, <code>service</code>, <code>pkg</code> execution modules and the <code>state.sls</code> function on <strong>any</strong> minion.</li>
</ol>
<p>Restart the <code>salt-api</code> and <code>salt-master</code> daemons to put your new settings into effect.</p>
<p>{WOULD SOME SORT OF DRAWING SHOWING THE INTEGRATION BE POSSIBLE?}</p>
<h3 id=step-3-installing-stackstorm>Step 3: Installing Stackstorm</h3>
<p>You can install Stackstorm with the following commands:</p>
<p>Ensure Stackstorm is running with</p>
<p>and it should look like the following:</p>
<p><img src=http://stackstorm.com/wp/wp-content/uploads/2015/07/check-status.gif alt="Check Status"></p>
<p>If any of the components aren’t running, executing <code>sudo st2ctl restart</code> will quickly get Stackstorm is a usable state.</p>
<h3 id=step-4-readying-the-saltstack-pack>Step 4: Readying the Saltstack Pack</h3>
<p>Given the salt pack requires some configuration, it’s wise to avoid the <code>packs.install</code> action.</p>
<p><a href=http://docs.stackstorm.com/packs.html#getting-a-pack>From the docs</a>, you should:</p>
<p>Assuming the default <code>base_path</code>, the salt pack will be installed at <code>/opt/stackstorm/packs/salt</code>. Fill the empty <code>config.yaml</code> file with the credentials of the <code>stackstorm</code> user from Step 2:</p>
<p>Register all actions contained in the pack:</p>
<p>Note: Ideally, you’d execute the above commands as part of a salt state. It’s best practice to generate <code>config.yaml</code> from a template and retrieve your <code>stackstorm</code> user credentials from an encrypted pillar.</p>
<p>Let’s take a look at the available actions:</p>
<p><img src=http://stackstorm.com/wp/wp-content/uploads/2015/07/action-list.gif alt="view action list"></p>
<p>There are a lot of actions! Don’t fret, just remember that Stackstorm actions map to Saltstack module functions along the following rules:</p>
<ol>
<li>Actions prefixed with <code>runner_</code> map to runner module functions (i.e. commands ran with <code>salt-run</code>).</li>
<li>Actions prefixed with <code>local_</code> map to execution module functions (i.e. commands ran with <code>salt</code>).</li>
</ol>
<p>Those aren’t the only module functions you can execute. Using the <code>salt.runner</code> and <code>salt.local</code> generic actions, you can execute any runner or execution functions, respectively!</p>
<p>Given we’ve authorized the <code>stackstorm</code> user to execute any runner function in Step 2, executing the following will return your living Saltstack minions:</p>
<h2 id=done-done>Done Done.</h2>
<p>You’ve successully configured Stackstorm to use the Saltstack pack. Stay tuned for another post on how to add ChatOps to the mix. Leveraging Stackstorm, we can add easily add ChatOps to your Saltstack Infrastructure!</p><ul class=pa0>
<li class=list>
<a href=/stackstorm.com/tags/tutorial class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">tutorial</a>
</li>
</ul>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l">
<div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
<p class="f5 b mb3">Related</p>
<ul class="pa0 list">
<li class=mb2>
<a href=/stackstorm.com/2015/07/08/automating-with-mistral-workflow/>Automated Troubleshooting With StackStorm and Mistral</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2015/06/12/integrating-chatops-with-stackstorm/>Integrating ChatOps With StackStorm</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2015/04/20/actions-of-all-flavors-in-stackstorm/>Actions Of All Flavors In StackStorm</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2015/04/03/rapid-integration-development-with-stackstorm/>Rapid Integration Development With StackStorm</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2015/01/14/managing-aws-instance-lifecycle-with-stackstorm/>Managing AWS Instance Lifecycle With StackStorm</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2014/12/22/monitor-twitter-and-fire-automations-based-on-twitter-keywords-using-stackstorm/>Monitor Twitter And Fire Automations Based On Twitter Keywords Using StackStorm</a>
</li>
</ul>
</div>
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://stackstorm.github.io/stackstorm.com>
&copy; StackStorm 2021
</a>
<div>
</div>
</div>
</footer>
</body>
</html>