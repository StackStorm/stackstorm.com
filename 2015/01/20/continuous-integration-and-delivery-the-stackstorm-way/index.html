<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Continuous Integration And Delivery, The StackStorm Way | StackStorm</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="January 20, 2015
by James Fryman
There have been so many times when I have been on both the receiving end and giving end of this conversation, and it goes something like this:

Me: Man, this awesome toolchain at Company X really makes it easy to ship software!
Friend: How can I get my hands on that hotness!?
Me: Well…. um…

And the conversation shifts… and the involved engineers begin discussing and sharing the good and bad about the toolchain, things that they want to do, how it’s helped… you get the idea. Unfortunately, the best that the receiver is going to get are the abstract ideas about these tools. Wonderful after-work discussion, but really horrible in actually helping share craft to make all of our jobs easier and more efficient.
Let’s face it. If it’s difficult to share small code snippets with each other, forget about it when talking about trying to share entire process toolchains. Oftentimes, they are hyper-specialized to a specific company, tightly coupled with systems. There has to be a better way to share operational patterns while allowing for the tweaks and knobs that are unique to each company.
This is a problem begging to be solved, and we’re taking a pass at it. And what better way to do that then to show off what can be done with StackStorm with a Continuous Delivery/Continuous Integration Pipeline.">
<meta name=generator content="Hugo 0.89.2">
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel=stylesheet href=/stackstorm.com/ananke/css/main.min.css>
<meta property="og:title" content="Continuous Integration And Delivery, The StackStorm Way">
<meta property="og:description" content="January 20, 2015
by James Fryman
There have been so many times when I have been on both the receiving end and giving end of this conversation, and it goes something like this:

Me: Man, this awesome toolchain at Company X really makes it easy to ship software!
Friend: How can I get my hands on that hotness!?
Me: Well…. um…

And the conversation shifts… and the involved engineers begin discussing and sharing the good and bad about the toolchain, things that they want to do, how it’s helped… you get the idea. Unfortunately, the best that the receiver is going to get are the abstract ideas about these tools. Wonderful after-work discussion, but really horrible in actually helping share craft to make all of our jobs easier and more efficient.
Let’s face it. If it’s difficult to share small code snippets with each other, forget about it when talking about trying to share entire process toolchains. Oftentimes, they are hyper-specialized to a specific company, tightly coupled with systems. There has to be a better way to share operational patterns while allowing for the tweaks and knobs that are unique to each company.
This is a problem begging to be solved, and we’re taking a pass at it. And what better way to do that then to show off what can be done with StackStorm with a Continuous Delivery/Continuous Integration Pipeline.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://stackstorm.github.io/stackstorm.com/2015/01/20/continuous-integration-and-delivery-the-stackstorm-way/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2015-01-20T18:33:28+00:00">
<meta property="article:modified_time" content="2015-01-20T18:33:28+00:00">
<meta itemprop=name content="Continuous Integration And Delivery, The StackStorm Way">
<meta itemprop=description content="January 20, 2015
by James Fryman
There have been so many times when I have been on both the receiving end and giving end of this conversation, and it goes something like this:

Me: Man, this awesome toolchain at Company X really makes it easy to ship software!
Friend: How can I get my hands on that hotness!?
Me: Well…. um…

And the conversation shifts… and the involved engineers begin discussing and sharing the good and bad about the toolchain, things that they want to do, how it’s helped… you get the idea. Unfortunately, the best that the receiver is going to get are the abstract ideas about these tools. Wonderful after-work discussion, but really horrible in actually helping share craft to make all of our jobs easier and more efficient.
Let’s face it. If it’s difficult to share small code snippets with each other, forget about it when talking about trying to share entire process toolchains. Oftentimes, they are hyper-specialized to a specific company, tightly coupled with systems. There has to be a better way to share operational patterns while allowing for the tweaks and knobs that are unique to each company.
This is a problem begging to be solved, and we’re taking a pass at it. And what better way to do that then to show off what can be done with StackStorm with a Continuous Delivery/Continuous Integration Pipeline."><meta itemprop=datePublished content="2015-01-20T18:33:28+00:00">
<meta itemprop=dateModified content="2015-01-20T18:33:28+00:00">
<meta itemprop=wordCount content="1714">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="Continuous Integration And Delivery, The StackStorm Way">
<meta name=twitter:description content="January 20, 2015
by James Fryman
There have been so many times when I have been on both the receiving end and giving end of this conversation, and it goes something like this:

Me: Man, this awesome toolchain at Company X really makes it easy to ship software!
Friend: How can I get my hands on that hotness!?
Me: Well…. um…

And the conversation shifts… and the involved engineers begin discussing and sharing the good and bad about the toolchain, things that they want to do, how it’s helped… you get the idea. Unfortunately, the best that the receiver is going to get are the abstract ideas about these tools. Wonderful after-work discussion, but really horrible in actually helping share craft to make all of our jobs easier and more efficient.
Let’s face it. If it’s difficult to share small code snippets with each other, forget about it when talking about trying to share entire process toolchains. Oftentimes, they are hyper-specialized to a specific company, tightly coupled with systems. There has to be a better way to share operational patterns while allowing for the tweaks and knobs that are unique to each company.
This is a problem begging to be solved, and we’re taking a pass at it. And what better way to do that then to show off what can be done with StackStorm with a Continuous Delivery/Continuous Integration Pipeline.">
</head>
<body class="ma0 avenir bg-near-white">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=/stackstorm.com/ class="f3 fw2 hover-white no-underline white-90 dib">
StackStorm
</a>
<div class="flex-l items-center">
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
POSTS
</aside>
<div id=sharing class=mt3>
<a href="https://www.facebook.com/sharer.php?u=https://stackstorm.github.io/stackstorm.com/2015/01/20/continuous-integration-and-delivery-the-stackstorm-way/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a>
<a href="https://twitter.com/share?url=https://stackstorm.github.io/stackstorm.com/2015/01/20/continuous-integration-and-delivery-the-stackstorm-way/&text=Continuous%20Integration%20And%20Delivery,%20The%20StackStorm%20Way" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://stackstorm.github.io/stackstorm.com/2015/01/20/continuous-integration-and-delivery-the-stackstorm-way/&title=Continuous%20Integration%20And%20Delivery,%20The%20StackStorm%20Way" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
</div>
<h1 class="f1 athelas mt3 mb1">Continuous Integration And Delivery, The StackStorm Way</h1>
<p class=tracked>
By <strong>
st2admin
</strong>
</p>
<time class="f6 mv4 dib tracked" datetime=2015-01-20T18:33:28Z>January 20, 2015</time>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p><strong>January 20, 2015</strong></p>
<p><em>by James Fryman</em></p>
<p>There have been so many times when I have been on both the receiving end and giving end of this conversation, and it goes something like this:</p>
<blockquote>
<p>Me: Man, this awesome toolchain at Company <em>X</em> really makes it easy to ship software!</p>
<p>Friend: How can I get my hands on that hotness!?</p>
<p>Me: Well…. um…</p>
</blockquote>
<p>And the conversation shifts… and the involved engineers begin discussing and sharing the good and bad about the toolchain, things that they want to do, how it’s helped… you get the idea. Unfortunately, the best that the receiver is going to get are the abstract ideas about these tools. Wonderful after-work discussion, but really horrible in actually helping share craft to make all of our jobs easier and more efficient.</p>
<p>Let’s face it. If it’s difficult to share small code snippets with each other, forget about it when talking about trying to share entire process toolchains. Oftentimes, they are hyper-specialized to a specific company, tightly coupled with systems. There has to be a better way to share operational patterns while allowing for the tweaks and knobs that are unique to each company.</p>
<p>This is a problem begging to be solved, and we’re taking a pass at it. And what better way to do that then to show off what can be done with StackStorm with a Continuous Delivery/Continuous Integration Pipeline.</p>
<h6 id=what-is-it>What Is It?</h6>
<p>This CI/CD Workflow is designed as a generic packaging and deployment pipeline. The aim here is to create a pipeline flexible enough to be able to push code of any type through, and prepare it for rapid deployment and management via StackStorm.</p>
<p>This pipeline uses the Canary pattern. In the canary pattern, code is deployed to a small subset of users before being ultimately rolled out to production. This allows for users to do testing on a smaller surface area and discover problems at small scale before they become large scale.</p>
<p>This workflow subscribes to the ‘Convention over Configuration’ approach to the world. Any project should be able to be used by this pipeline, assuming it follows these conventions:</p>
<ul>
<li>CI Portion</li>
<li>A project exists on GitHub, and has its outgoing webhook configured to send to StackStorm</li>
<li>The project has two scripts designed to ensure the project is setup for CI</li>
<li>`script/cisetup` – Prepares the build directory to run CI. Executed prior to CI begin</li>
<li>`script/cibuild` – Commands to test the execute the CI build process</li>
<li>Project has been configured on Jenkins Server</li>
<li>Project has a post-install script (`script/post-inst`) to do any items post-package installation</li>
<li>(NOTE: Any of the scripts can simply `exit 0`, but they need to exist)</li>
<li>Consul has been configured to advertise servers with the following tags:</li>
<li>‘appname::approle’</li>
<li>‘appname::approle_canary’</li>
<li>By default, appname is the project name, and approle is `app`</li>
</ul>
<p>All of this code is open-source, and available for you to explore and use as best as you can. The code for this operational pattern can be found in our StackStorm Showcase at <a href=https://github.com/stackstorm-showcase/cicd-canary>https://github.com/stackstorm-showcase/cicd-canary</a>.</p>
<h6 id=design-decisions>Design Decisions</h6>
<p>This workflow was designed initially to cover the most generic use-case possible, and attempts to make few assumptions about the operating environment that this could be used in. Specifically:</p>
<ul>
<li>The application language used should not be relevant to the pipeline</li>
<li>The deploy mechanism must be native to the operating system</li>
<li>Deploys should make best-effort at synchronous deployment, and also be eventually consistent</li>
</ul>
<h6 id=architecture>Architecture</h6>
<p>Below is a list of components that make up the underlying infrastructure in aggregate, and shows how StackStorm fits into the overall picture of asset management. Many of the tools here were chosen to allow use in an isolated, local environment.</p>
<ul>
<li>Load Balancing: HAProxy</li>
<li>Continuous Delivery</li>
<li>Asset: OS Packages</li>
<li>Strategy: Canary</li>
<li>Continuous Integration Server: Jenkins</li>
<li>Service Discovery: Consul</li>
<li>Orchestration Layer: StackStorm</li>
<li>Configuration Management: Puppet / Consul-Template</li>
<li>Provisioning: Vagrant / EC2 / DigitalOcean</li>
</ul>
<h6 id=process-flow>Process Flow</h6>
<p>Who doesn’t love process flows? Oftentimes, a picture says much more than words can. But, in the event that you also like words… the workflow in complete is listed below. As you’ll see below, all of the items are very small in nature, and different tools are combined to create a robust toolchain.</p>
<ol>
<li>
<p>User pushes new commit to GitHub</p>
</li>
<li>
<p>[GitHub] Fires a webhook to StackStorm</p>
</li>
<li>
<p>[StackStorm :: Web Hook] StackStorm receives the webhook, and matches it to an incoming rule to begin a CI Job</p>
</li>
<li>
<p>[Jenkins] Clones application from GitHub</p>
</li>
<li>
<p>[Jenkins] On build completion, sends a webhook back to StackStorm with Success/Failure</p>
</li>
<li>
<p>[Jenkins :: Success] StackStorm kicks off packaging workflow to build an OS package from the application.</p>
</li>
<li>
<p>[Package] StackStorm queries Consul for an available host to build a package</p>
</li>
<li>
<p>[Package] StackStorm downloads the application from GitHub</p>
</li>
<li>
<p>[Package] StackStorm queries the downloaded repository for metadata to build the package</p>
</li>
<li>
<p>[Package] StackStorm packages up the repository using FPM</p>
</li>
<li>
<p>[Package] StackStorm takes the package and inserts it into Freight (APT Repository), marking it eligible for download</p>
</li>
<li>
<p>[Package] StackStorm cleans up all tempfiles and hands off to Deploy Workflow</p>
</li>
<li>
<p>[Deploy :: Canary] StackStorm updates the currently advertised version of the application to deploy.</p>
</li>
<li>
<p>[Deploy :: Canary] StackStorm queries all hosts that have been tagged as ‘canary’</p>
</li>
<li>
<p>[Deploy :: Canary] StackStorm tells all canary hosts a package has been updated, and updates the servers.</p>
</li>
<li>
<p>User waits for any external alarms to fire (New Relic, Nagios, etc).</p>
</li>
<li>
<p>If no failures, user deploys new package to production.</p>
</li>
<li>
<p>[Deploy :: Production] StackStorm updates the currently advertised version to the currently deployed canary version</p>
</li>
<li>
<p>[Deploy :: Production] StackStorm tells all production hosts a package has been updated, and updates the servers.</p>
</li>
</ol>
<h3 id=decisions-decisions>Decisions, Decisions</h3>
<p>The architecture decisions in this pipeline are pretty arbitrary. Every infrastructure is slightly different, which is part of what makes the problem of sharing infrastructure patterns all that much more difficult. But, what we hope is illustrated here is just how easy it is to swap out different components of the stack.</p>
<p>Having problems with Jenkins? Get rid of it. Want to try out containers? Add it to the workflow/pipeline. Composing complex pipelines is now getting easier. This workflow may not fit your needs completely, but it should get you quite a bit further. On top of that, all of the code adheres to the ‘Infrastructure as Code’ ethos, and Pull Requests are gladly accepted.</p>
<h6 id=why-this-way-as-opposed-to8230>Why this way as opposed to…</h6>
<h6 id=8230with-bash-scripts>…with `bash` scripts?</h6>
<p><code>bash</code> scripts are a great way to get started with automation, and to quickly prototype things you need to get done. No doubt about it, we are huge fans of all things shell over here at StackStorm! The downside though is that over time, these scripts become a bit kludgy and difficult to manage. With StackStorm, we integrate with many of these soon-to-be or already written scripts, but we take responsibility for things like auditing, logging, user interfaces with help, an API and reliability and for tying them into a broader pipeline via a rules engine and workflow. We make it so that the shell scripts can focus on doing what they are great at doing… the quick and dirty stuff.</p>
<h6 id=8230-jenkins>… Jenkins.</h6>
<p>It’s true. Jenkins has a lot of the workflow management inside of it, and has proven to be robust in creating great delivery stories. We certainly tip our hat to the efforts there. StackStorm provides additional benefits in a few key areas:</p>
<ol>
<li>Not tied to a single technology. With Jenkins, you must use their UI, and write their XML. With StackStorm, the driving technology can be any language and any tool. Use our API to interact however you want, and write files in easy to understand YAML.</li>
<li>Respond to additional events. StackStorm goes above and beyond Jenkins… adding the ability to take in additional information about events happening in your datacenter, and to use that to make additional decisions.</li>
</ol>
<h6 id=get-crazy>Get Crazy!</h6>
<p>One of the more interesting benefits of a system like this is the ability to protect yourself… from yourself. How many times have you made the wrong move on a computer, and the subsequent day/week/month was not too pleasant? For me, far too many to care to say. In this pipeline, I built out logic that prevents a production deploy from happening straight to code. When the user issues a production deploy command, the only possible choice they have is to promote the currently running canary version.</p>
<p>This enforces good practice amongst the deployment pipeline. Combined with the fact that this policy is already documented as code, the ability to adapt and change policy is enforced, auditable, and easily adaptable.</p>
<h6 id=overall>Overall</h6>
<p>I’m really excited about this. This is really only the tip of the iceberg in terms of what StackStorm can do for you, and where we are going! I am most interested in learning about how many of you take the code for this solution and start to adapt it for your organization. What things of this pattern did you use? Which ones did you toss? Most importantly – how much effort was it to build upon this pattern? Our goal is to make it such that we can get you around ~80% of the way with our platform and solutions like this, and the last mile is all yours to run with. So, if you do play with this, please let us know! We love feedback (the good kind and the best kind… but also the constructive kind if you have it).</p>
<p>There has been a ton of photos in here, and they often speak volumes more than words do. We’re continuing to refine our ChatOps story, and you’ll see some of that in this solution.</p>
<p><a href=http://stackstorm.com/wp/wp-content/uploads/2015/01/700.jpg></a></p>
<p>And if you are interested in seeing a demo of this in action, we have a video! Check it out here:</p>
<h6 id=more-things-to-come8230>More things to come…</h6>
<p>We’re continuing to work on new features to add to the core StackStorm platform. Over the next several months, we’ll be adding features like:</p>
<ul>
<li>Web Based GUI</li>
<li>Role Based Access Control</li>
<li>Additional ChatOps Interfaces</li>
<li>… and so much other cool stuff I can hardly wait!</li>
</ul>
<p>If you haven’t already, we invite you to check out our product by <a href=http://docs.stackstorm.com/install/index.html>installing StackStorm</a> and following the <a href=http://docs.stackstorm.com/start.html>quick start</a> instructions — it will take less than 30 minutes to give you a taste of our automation. Share your thoughts and ideas via <a href=mailto:stackstorm@googlegroups.com>stackstorm@googlegroups.com</a>, <a href="http://webchat.freenode.net/?channels=stackstorm">#stackstorm on irc.freenode.net</a> or on Twitter <a href=https://twitter.com/Stack_Storm>@Stack_Storm</a>.</p>
<p>Until Next Time!<br>
 </p><ul class=pa0>
</ul>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l">
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://stackstorm.github.io/stackstorm.com>
&copy; StackStorm 2021
</a>
<div>
</div>
</div>
</footer>
</body>
</html>