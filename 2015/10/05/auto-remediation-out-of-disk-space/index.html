<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Auto-remediation by example: handling out-of-disk-space. | StackStorm</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="October 5, 2015
by Dmitri Zimine, Patrick Hoolboom
A host is running out of disk space. What follows is a routine pager panic and rush in cleaning things up, at best. At worst, downtime. It is silly, but it happens much more than most of us care to admit.
This, and many other annoying events like this can, and shall be auto-remediated. The “classic” pattern of wiring monitoring to and paging is simply not good enough, and know it when you’re paged at 3am to clean the disk on production server.
And to those of you who hard-wire their remediation scripts into Nagios/Sensu event handlers, Splunk alert scripts and NewRelic web hooks: it is plain wrong there’s a better way.
In this blog, we show how StackStorm auto-remediation platform helps you hand out-of-disk case, with step-by-step walk-through and a working automation sample to kick-start your auto-remediation.">
<meta name=generator content="Hugo 0.89.2">
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel=stylesheet href=/stackstorm.com/ananke/css/main.min.css>
<meta property="og:title" content="Auto-remediation by example: handling out-of-disk-space.">
<meta property="og:description" content="October 5, 2015
by Dmitri Zimine, Patrick Hoolboom
A host is running out of disk space. What follows is a routine pager panic and rush in cleaning things up, at best. At worst, downtime. It is silly, but it happens much more than most of us care to admit.
This, and many other annoying events like this can, and shall be auto-remediated. The “classic” pattern of wiring monitoring to and paging is simply not good enough, and know it when you’re paged at 3am to clean the disk on production server.
And to those of you who hard-wire their remediation scripts into Nagios/Sensu event handlers, Splunk alert scripts and NewRelic web hooks: it is plain wrong there’s a better way.
In this blog, we show how StackStorm auto-remediation platform helps you hand out-of-disk case, with step-by-step walk-through and a working automation sample to kick-start your auto-remediation.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://stackstorm.github.io/stackstorm.com/2015/10/05/auto-remediation-out-of-disk-space/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2015-10-05T22:59:54+00:00">
<meta property="article:modified_time" content="2015-10-05T22:59:54+00:00">
<meta itemprop=name content="Auto-remediation by example: handling out-of-disk-space.">
<meta itemprop=description content="October 5, 2015
by Dmitri Zimine, Patrick Hoolboom
A host is running out of disk space. What follows is a routine pager panic and rush in cleaning things up, at best. At worst, downtime. It is silly, but it happens much more than most of us care to admit.
This, and many other annoying events like this can, and shall be auto-remediated. The “classic” pattern of wiring monitoring to and paging is simply not good enough, and know it when you’re paged at 3am to clean the disk on production server.
And to those of you who hard-wire their remediation scripts into Nagios/Sensu event handlers, Splunk alert scripts and NewRelic web hooks: it is plain wrong there’s a better way.
In this blog, we show how StackStorm auto-remediation platform helps you hand out-of-disk case, with step-by-step walk-through and a working automation sample to kick-start your auto-remediation."><meta itemprop=datePublished content="2015-10-05T22:59:54+00:00">
<meta itemprop=dateModified content="2015-10-05T22:59:54+00:00">
<meta itemprop=wordCount content="739">
<meta itemprop=keywords content="Auto-remediation,tutorial,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Auto-remediation by example: handling out-of-disk-space.">
<meta name=twitter:description content="October 5, 2015
by Dmitri Zimine, Patrick Hoolboom
A host is running out of disk space. What follows is a routine pager panic and rush in cleaning things up, at best. At worst, downtime. It is silly, but it happens much more than most of us care to admit.
This, and many other annoying events like this can, and shall be auto-remediated. The “classic” pattern of wiring monitoring to and paging is simply not good enough, and know it when you’re paged at 3am to clean the disk on production server.
And to those of you who hard-wire their remediation scripts into Nagios/Sensu event handlers, Splunk alert scripts and NewRelic web hooks: it is plain wrong there’s a better way.
In this blog, we show how StackStorm auto-remediation platform helps you hand out-of-disk case, with step-by-step walk-through and a working automation sample to kick-start your auto-remediation.">
</head>
<body class="ma0 avenir bg-near-white">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=/stackstorm.com/ class="f3 fw2 hover-white no-underline white-90 dib">
StackStorm
</a>
<div class="flex-l items-center">
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
POSTS
</aside>
<div id=sharing class=mt3>
<a href="https://www.facebook.com/sharer.php?u=https://stackstorm.github.io/stackstorm.com/2015/10/05/auto-remediation-out-of-disk-space/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a>
<a href="https://twitter.com/share?url=https://stackstorm.github.io/stackstorm.com/2015/10/05/auto-remediation-out-of-disk-space/&text=Auto-remediation%20by%20example:%20handling%20out-of-disk-space." class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://stackstorm.github.io/stackstorm.com/2015/10/05/auto-remediation-out-of-disk-space/&title=Auto-remediation%20by%20example:%20handling%20out-of-disk-space." class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
</div>
<h1 class="f1 athelas mt3 mb1">Auto-remediation by example: handling out-of-disk-space.</h1>
<p class=tracked>
By <strong>
Dmitri Zimine
</strong>
</p>
<time class="f6 mv4 dib tracked" datetime=2015-10-05T22:59:54Z>October 5, 2015</time>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p><strong>October 5, 2015</strong><br>
<em>by Dmitri Zimine, Patrick Hoolboom</em></p>
<p>A host is running out of disk space. What follows is a routine pager panic and rush in cleaning things up, at best. At worst, downtime. It is silly, but it happens much more than most of us care to admit.</p>
<p>This, and many other annoying events like this can, and shall be auto-remediated. The “classic” pattern of wiring monitoring to and paging is simply not good enough, and know it when you’re paged at 3am to clean the disk on production server.</p>
<p>And to those of you who hard-wire their remediation scripts into Nagios/Sensu event handlers, Splunk alert scripts and NewRelic web hooks: it is plain wrong there’s a better way.</p>
<p>In this blog, we show how StackStorm auto-remediation platform helps you hand out-of-disk case, with step-by-step walk-through and a working automation sample to kick-start your auto-remediation.</p>
<p>If you’re in the hurry, grab the automation code in <a href=https://github.com/StackStorm/st2_demos>st2_demos</a> and run it on your StackStorm instance.</p>
<p>For the rest, let’s walk through the three steps of setting auto-remediation with StackStorm. First, configure the integrations with monitoring and paging system, Second, define your auto-remediation workflow, “runbook as code”. Third, create a rule mapping event to auto-remediation.</p>
<h3 id=1-set-up-the-integrations>1. Set up the integrations.</h3>
<p>Install <a href=https://github.com/StackStorm-Exchange/stackstorm-sensu>sensu</a> and <a href=https://github.com/StackStorm-Exchange/stackstorm-victorops>victorops</a> pack from <a href=https://exchange.stackstorm.org>StackStorm Exchange</a>:</p>
<p>Configure to point to your Sensu and Victorops <code>/opt/stackstorm/configs/sensu.yaml</code> and <code>/opt/stackstorm/configs/victorops.yaml.</code>Or just run <code>st2 pack config sensu</code> and <code>st2 pack config victorops</code>, and answer the questions. Follow the detailed instructions on <a href=https://github.com/StackStorm-Exchange/stackstorm-sensu>sensu pack</a> to send Sensu events to StackStorm. If you are on Nagios, NewRelic, Splunk, or other monitoring – pick the integration for your tool. New integrations are easy to build, we welcome and support your contributions. Likewise, if you happen to use PagerDuty – grab and configure <a href=https://github.com/StackStorm-Exchange/stackstorm-pagerduty>pagerduty pack</a>.</p>
<p>In this example ChatOps with Slack is used to post updates and fire commands. If you’re on HipChat or IRC or some other chat, or still prefer Email or SMS or JIRA for notifications – adjust accordingly.</p>
<h3 id=2-design-your-auto-remediation-action>2. Design your auto-remediation action.</h3>
<p>This is yours to define. Our example here is “if disk is filled up with log files, just prune them, if it’s something else, wake me up”. Read the workflow code from <a href=https://github.com/StackStorm/st2incubator/blob/master/packs/st2-demos/actions/workflows/diskspace_remediation.yaml>diskspace_remediation.yaml</a>, it’s self-explanatory. Note that action results are passed down the flow.</p>
<p>Define your workflow your way. Your environment, tools and run books are special. You may want to move files to s3 instead of deleting. Or provision and attach an extra volume. Or check for few other suspects before paging. And your logic will differ dependent on server role. Please yourself, mix and match your scripts with existing building blocks in the workflow that works for your case.</p>
<p>If you are on <a href=https://stackstorm.com/product/#enterprise>StackStorm Enterprise</a>: the workflow graphical editor, Workflow Designer, will help create and visualize the workflows. Here is how the our sample diskspace remediation looks in Workflow Designer:</p>
<p><a href=http://stackstorm.com/wp/wp-content/uploads/2015/10/flow_diskspace_remediation.png></a></p>
<p><img src=http://stackstorm.com/wp/wp-content/uploads/2015/10/flow_diskspace_remediation.png alt="Editing diskspace_remediation.yaml in Flow"></p>
<h3 id=3create-a-rule>3.Create a rule.</h3>
<p>Create a rule: if monitoring event triggers, fire the remediation action. The rule definition code shown below. Note that the trigger payload is parsed, used in criteria, and passed in action input.</p>
<p>If you like StackStorm’s slick UI, you can use it to create the rule. Or use CLI:</p>
<h3 id=profit>Profit!</h3>
<p>Create a large file (an action in our sample pack does this for you), and see how StackStorm fires the actions. If you create the large file somewhere else, check that you’ll get an incident in VictorOps. Now that you know it works, enjoy: this irritating “out-of-disk space” problems will be auto-fixed before the page would even reach you.</p>
<p>And one more key thing: Manage your automation as code. Create an automation pack – just as we did with <a href=https://github.com/StackStorm/st2_demos>st2_demos</a>, commit to git, review, and deploy by <code>st2 pack install</code>. Or share it on github and exchange auto-remediation patterns and run books with your fellow devops – as code!</p>
<p>Hope this gives you a good start on the path to auto-remediation. At first, setting up StackStorm just for the sake of one simple integration may seem an overkill. But now that you have it all set up, adding automations is easy, almost addictive. Soon you’ll enjoy the compound value of rich action library, automation control plain under source control, and auto-remediations that keep your pager from going off at night.</p>
<p>And did you drink ChatOps cool-aid? Check what it can do for your operations, like <a href=https://stackstorm.com/2015/08/14/user-story-stackstorm-workflows-and-chatops/>these guys did</a>, and stay tuned for our next blogs!</p><ul class=pa0>
<li class=list>
<a href=/stackstorm.com/tags/auto-remediation class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Auto-remediation</a>
</li>
<li class=list>
<a href=/stackstorm.com/tags/tutorial class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">tutorial</a>
</li>
</ul>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l">
<div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
<p class="f5 b mb3">Related</p>
<ul class="pa0 list">
<li class=mb2>
<a href=/stackstorm.com/2015/10/02/tutorial-of-the-week-cassandra-auto-remediation/>Tutorial of the Week: Cassandra Auto-Remediation</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2015/09/15/java-action/>Turning Java App Into StackStorm Action</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2015/07/29/getting-started-with-stackstorm-and-saltstack/>Getting Started With StackStorm and SaltStack</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2015/07/08/automating-with-mistral-workflow/>Automated Troubleshooting With StackStorm and Mistral</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2015/06/12/integrating-chatops-with-stackstorm/>Integrating ChatOps With StackStorm</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2015/04/20/actions-of-all-flavors-in-stackstorm/>Actions Of All Flavors In StackStorm</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2015/04/03/rapid-integration-development-with-stackstorm/>Rapid Integration Development With StackStorm</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2015/01/14/managing-aws-instance-lifecycle-with-stackstorm/>Managing AWS Instance Lifecycle With StackStorm</a>
</li>
<li class=mb2>
<a href=/stackstorm.com/2014/12/22/monitor-twitter-and-fire-automations-based-on-twitter-keywords-using-stackstorm/>Monitor Twitter And Fire Automations Based On Twitter Keywords Using StackStorm</a>
</li>
</ul>
</div>
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://stackstorm.github.io/stackstorm.com>
&copy; StackStorm 2021
</a>
<div>
</div>
</div>
</footer>
</body>
</html>