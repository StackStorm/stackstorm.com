<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Microsoft Azure Event Grid explained for StackStorm users | StackStorm</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="October 05, 2017
by Dmitri Zimine
Two new event-driven systems were introduced last month. Event Grid from Microsoft Azure and Event Gateway from Serverless.com were launched two days apart from each other. An event that triggered these announcements seem to be emitted by Emit conference on serverless. Serverless computing became a primary driver for the event-centric approach, and as serverless architectural patterns emerged, the need for a dedicated event router became apparent.">
<meta name=generator content="Hugo 0.89.2">
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel=stylesheet href=/stackstorm.com/ananke/css/main.min.css>
<meta property="og:title" content="Microsoft Azure Event Grid explained for StackStorm users">
<meta property="og:description" content="October 05, 2017
by Dmitri Zimine
Two new event-driven systems were introduced last month. Event Grid from Microsoft Azure and Event Gateway from Serverless.com were launched two days apart from each other. An event that triggered these announcements seem to be emitted by Emit conference on serverless. Serverless computing became a primary driver for the event-centric approach, and as serverless architectural patterns emerged, the need for a dedicated event router became apparent.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://stackstorm.github.io/stackstorm.com/2017/10/05/event-grid-event-gateway-explained-part1/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2017-10-05T20:04:17+00:00">
<meta property="article:modified_time" content="2017-10-05T20:04:17+00:00">
<meta itemprop=name content="Microsoft Azure Event Grid explained for StackStorm users">
<meta itemprop=description content="October 05, 2017
by Dmitri Zimine
Two new event-driven systems were introduced last month. Event Grid from Microsoft Azure and Event Gateway from Serverless.com were launched two days apart from each other. An event that triggered these announcements seem to be emitted by Emit conference on serverless. Serverless computing became a primary driver for the event-centric approach, and as serverless architectural patterns emerged, the need for a dedicated event router became apparent."><meta itemprop=datePublished content="2017-10-05T20:04:17+00:00">
<meta itemprop=dateModified content="2017-10-05T20:04:17+00:00">
<meta itemprop=wordCount content="1394">
<meta itemprop=keywords content="azure,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Microsoft Azure Event Grid explained for StackStorm users">
<meta name=twitter:description content="October 05, 2017
by Dmitri Zimine
Two new event-driven systems were introduced last month. Event Grid from Microsoft Azure and Event Gateway from Serverless.com were launched two days apart from each other. An event that triggered these announcements seem to be emitted by Emit conference on serverless. Serverless computing became a primary driver for the event-centric approach, and as serverless architectural patterns emerged, the need for a dedicated event router became apparent.">
</head>
<body class="ma0 avenir bg-near-white">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=/stackstorm.com/ class="f3 fw2 hover-white no-underline white-90 dib">
StackStorm
</a>
<div class="flex-l items-center">
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
POSTS
</aside>
<div id=sharing class=mt3>
<a href="https://www.facebook.com/sharer.php?u=https://stackstorm.github.io/stackstorm.com/2017/10/05/event-grid-event-gateway-explained-part1/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a>
<a href="https://twitter.com/share?url=https://stackstorm.github.io/stackstorm.com/2017/10/05/event-grid-event-gateway-explained-part1/&text=Microsoft%20Azure%20Event%20Grid%20explained%20for%20StackStorm%20users" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://stackstorm.github.io/stackstorm.com/2017/10/05/event-grid-event-gateway-explained-part1/&title=Microsoft%20Azure%20Event%20Grid%20explained%20for%20StackStorm%20users" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
</div>
<h1 class="f1 athelas mt3 mb1">Microsoft Azure Event Grid explained for StackStorm users</h1>
<p class=tracked>
By <strong>
Dmitri Zimine
</strong>
</p>
<time class="f6 mv4 dib tracked" datetime=2017-10-05T20:04:17Z>October 5, 2017</time>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>October 05, 2017<br>
<em>by Dmitri Zimine</em></p>
<p>Two new event-driven systems were introduced last month. Event Grid from Microsoft Azure and Event Gateway from Serverless.com were launched two days apart from each other. An event that triggered these announcements seem to be emitted by Emit conference on serverless. Serverless computing became a primary driver for the event-centric approach, and as serverless architectural patterns emerged, the need for a dedicated event router became apparent.</p>
<p>StackStorm, Event Grid, and Event Gateway are conceptually the same family, despite different target use (devops automation vs serverless) and delivery form-factor (installable vs PaaS). All three are event router services, mapping and routing events from multiple event sources to multiple target systems.</p>
<p>StackStorm pioneered applying the <a href=https://www.thenewstack.io/tag/event-driven-architecture>event-driven computing</a> to DevOps automation. Over 4 years of evolving StackStorm, operating it ourselves, and learning from thousands of the users, who have been running StackStorm in a wide variety of applications and scales, we gained a solid perspective on what works well for this class of products. Here, I’ll use this perspective and experience to review and compare the functionality and feature set of the “new kids on the blog” (pun intended).</p>
<p>First, let’s “normalize” the terminology: I use StackStorm terms as a reference point, as StackStorm blog regulars are dearly familiar with them, and add a short explanation for everyone.</p>
<table>
<thead>
<tr>
<th>StackStorm</th>
<th>Event Grid</th>
<th>Event Gateway</th>
<th>What is it</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sensors</td>
<td>Event publishers</td>
<td>N/A (out of scope)</td>
<td>Event sources and a system responsible for ingesting external events</td>
</tr>
<tr>
<td>Triggers</td>
<td>Topics</td>
<td>Events</td>
<td>System representation of the external event</td>
</tr>
<tr>
<td>Rules</td>
<td>Subscriptions</td>
<td>Subscriptions</td>
<td>Triggers-to-Actions map, filtering, conditions, data passing</td>
</tr>
<tr>
<td>Actions</td>
<td>Event Handlers</td>
<td>Function</td>
<td>Target system invocation</td>
</tr>
</tbody>
</table>
<p>If you’re new to StackStorm, you can refresh refresh the concept of event driven automation at <a href=https://docs.stackstorm.com/overview.html>StackStorm documentation</a>.</p>
<p>The common questions to evaluate the event automation products in the family would be:</p>
<ul>
<li>What triggers and actions are possible? What are already available? How can they be extended?</li>
<li>How are rules defined? What are the filtering and data transforming capabilities?</li>
<li>What are event delivery guarantees, throughput, and scale characteristics?</li>
</ul>
<p>And of course there is something uniquely interesting in each system. What is it?<br>
With that, let’s start with <strong>Event Grid</strong> first.</p>
<h2 id=event-grid-by-azure>Event Grid by Azure</h2>
<p><a href=https://docs.microsoft.com/en-us/azure/event-grid/overview>Event Grid</a> is defined <em>“a fully-managed event routing service that allows for uniform event consumption using a publish-subscribe model, reacting to events in near-realtime fashion”</em>. It is currently in “preview”, supporting only a subset of Azure services. There is documentation and a few examples.</p>
<p>Explaining <a href=https://azure.microsoft.com/en-us/blog/events-data-points-and-messages-choosing-the-right-azure-messaging-service-for-your-data/>how Event Grid is different from some seemingly similar Azure services</a>, <a href=https://azure.microsoft.com/en-us/blog/author/clemensv/>Clemens Vasters</a>, one of Azure architects, clarifies that it is intended <em>“for the model where there’s a very large number of different events for different contexts emitted by an application or platform service, and a consumer may be interested in just one particular event type or just one particular context.”</em></p>
<h4 id=event-publishers>Event publishers</h4>
<p>Just like StackStorm’s triggers are backed by Sensors, Azure topic types are backed by Event publishers. Currently, they are:</p>
<ul>
<li>Management operation events from Azure Subscriptions or Resource groups and subscriptions (e.g., ‘VM created’).</li>
<li><a href=https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-what-is-event-hubs>Event hubs</a> – at preview, limited by “Capture” storage event but will likely be a firehose of the interesting events in a future.</li>
<li>Custom topics – a point to post HTTP(s) events – similar to StackStorm Webhook trigger. They serve as an open extensibility point, offering API to define and submit custom / 3rd party events. Yes, if you’re outside of Azure, HTTP(s) to a custom topic is the way to push event into Event Grid.</li>
</ul>
<p>I find myself confused by an overlap with <a href=https://docs.microsoft.com/en-us/azure/logic-apps/logic-apps-what-are-logic-apps>Azure Logic Apps</a>. Logic Apps is primarily an actor/subscriber for an EventGrid, but has it’s own “event-driven” part with an <a href=https://docs.microsoft.com/en-us/azure/connectors/apis-list>impressive count of 169 event sources</a> called triggers. Triggers mostly follow “poll” model and publish events to Logic Apps, but they are not event sources for EventGrid, unfortunately. Hopefully this confusion is temporary and our Azure friends will find a way to rationalize it.</p>
<h4 id=topics>Topics</h4>
<p>Azure Topics are pretty much StackStorm <a href=https://docs.stackstorm.com/webhooks.html>Webhook trigger types</a>. Looking closer, there is a granular picture of Topic Types, Topics, and Events generated by the topic (similar to StackStorm’s Trigger types, Triggers, and Trigger Instances). As mentioned above, “Custom topics” are not the only source of events – other Azure system act as Event Sources and emit events – but they are the one with the open API for solution integration.</p>
<p>Events have id, source reference, subject, and carry a payload in the <code>data</code> object, The schema of <code>data</code> specific to event publisher and schema-less (unlike StackStorm where the event source may choose to publish the schema to help the user refer data for filtering and data transformation).</p>
<h4 id=event-handlers>Event Handlers</h4>
<p>Event Handlers are “places where events are sent”, also called “endpoints”. Currently the HTTP/Webhook endpoints, and the Azure Storage Queue are available endpoints, however more event handlers are expected to come. It would be more precise to compare Event Handlers with StackStorm Runners: both abstract a class of endpoints (or “actions). But StackStorm hides this behind “Action” : an action is an action regardless the runner type; even workflow is an action from invocation viewpoint. Event Grid does not offers a dedicated action abstraction of “Action”, like StackStorm or Logic Apps. The target endpoint is defined as part of “Subscription” by endpoint type and endpoint URL (in API, it’s also called <a href=https://docs.microsoft.com/en-us/rest/api/eventgrid/eventsubscriptions/create#definitions_eventsubscriptiondestination>Event Subscription Desitnation</a>.</p>
<h4 id=subscriptions>Subscriptions</h4>
<p>Subscriptions are comparable to Rules in StackStorm: they map events to target endpoints. In Azure’s words, they <em>“instruct Event Grid on which events on a topic a subscriber is interested in receiving …, and also holds information on how events should be delivered to the subscriber.”</em> Event-to-endpoint mapping is one-to-one. To achieve “fan out” – map one event to multiple endpoints – multiple subscriptions must be created.</p>
<p>Filtering is available, but limited to event type and or event subject pattern. There is no filtering based on event data itself. From my experience with StackStorm, this is a problem as it limits the routing capabilities. For example, reaction on a monitoring event is based on severity, which is a field in event data. Architecturally, it pushes part of event routing logic between EventGrid and the target endpoint. This imperfection already shows: <a href=https://blog.eldert.net/integration-patterns-in-azure-message-router-using-logic-apps/>“Message router using Logic apps”</a> is ironically offered as a pattern, where it should be entirely an EventGrid use case.</p>
<p>There is no data transformation: the event data are routed to the target endpoint “as is”. That means the Event Handler needs to know and handle Event Publisher’s data schema. Again, abstraction leaks here: ideally, event routing shall keep entire responsibility of mapping “any” event source to “any” event target without demanding modifications on source or target.<br>
I suspect these limitations are the result of a conscious architectural trade off to not parse event data to gain high throughput. But it could be solved by making subscriptions only parse the events when user user requested filtering on event data or data transformation.</p>
<h4 id=delivery-guarantee>Delivery guarantee</h4>
<p>Event Grid clearly declares “at least one” delivery guarantee. That means that once the event is accepted, Event Grid will a) not lose an event, and b) <a href=https://docs.microsoft.com/en-us/azure/event-grid/delivery-and-retry>will retry calling an event target</a> on the backoff schedule until it succeeds, or event expires (4 hours in Preview will turn to 24 hours by release). The lack of control over the retry policy is upsetting: retry may help with 503 Service Unavailable or 408 Request timeout but is no use for “401 unauthorized” or “414 URL too long”. I prefer to model “retry” as an action invocation policy, make it dependent both on action type and invocation content, and user configured configured.</p>
<h4 id=in-summary>In Summary</h4>
<p>The most amazing thing about Event Grid is “pricing”: $0.30 for 1 Million operations… Pause here to reflect: it’s $10 a year for one event per second! This hints a giant scale and suggests the use for solutions where routing of massive event flows required, like IoT, or user click analysis. At the current state the model is still maturing, the terminology exposes the org structure (e.g., same things called differently marketecture, docs, API and CLI), and only few event publishers and handlers are available. Well, this is exactly as Preview is supposed to be. The real world usage will inform the roadmap, and I expect it to mature into in a key building block of Azure PaaS.</p>
<h2 id=event-gateway-by-serverlesscom>Event Gateway by Serverless.com</h2>
<p>… will be covered in Part 2. Stay tuned!</p><ul class=pa0>
<li class=list>
<a href=/stackstorm.com/tags/azure class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">azure</a>
</li>
</ul>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l">
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://stackstorm.github.io/stackstorm.com>
&copy; StackStorm 2021
</a>
<div>
</div>
</div>
</footer>
</body>
</html>