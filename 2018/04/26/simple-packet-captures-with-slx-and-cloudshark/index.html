<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Simple Packet Captures with SLX and CloudShark | StackStorm</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="April 27, 2018
by Lindsay Hill
Packet Captures are a necessary evil when you need to prove network innocence. But they’re tedious to configure, collect &amp; analyze. What if you could simplify the setup, collection and viewing? That’s what we’ve done here, combining StackStorm, Extreme Insight Architecture, CloudShark, and of course Slack.
Demo: Running Packet Captures from Slack
Check out the video here – we show entering some commands in Slack, which triggers a packet capture on multiple switches. The PCAPs are automatically uploaded to CloudShark, so we can view the packets in our browser:
Read on for more about how to set this up.">
    <meta name="generator" content="Hugo 0.89.2" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
<link rel="stylesheet" href="/stackstorm.com/ananke/css/main.min.css" >




    
      

    

    
    
    <meta property="og:title" content="Simple Packet Captures with SLX and CloudShark" />
<meta property="og:description" content="April 27, 2018
by Lindsay Hill
Packet Captures are a necessary evil when you need to prove network innocence. But they’re tedious to configure, collect &amp; analyze. What if you could simplify the setup, collection and viewing? That’s what we’ve done here, combining StackStorm, Extreme Insight Architecture, CloudShark, and of course Slack.
Demo: Running Packet Captures from Slack
Check out the video here – we show entering some commands in Slack, which triggers a packet capture on multiple switches. The PCAPs are automatically uploaded to CloudShark, so we can view the packets in our browser:
Read on for more about how to set this up." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://stackstorm.github.io/stackstorm.com/2018/04/26/simple-packet-captures-with-slx-and-cloudshark/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-27T03:54:32+00:00" />
<meta property="article:modified_time" content="2018-04-27T03:54:32+00:00" />

<meta itemprop="name" content="Simple Packet Captures with SLX and CloudShark">
<meta itemprop="description" content="April 27, 2018
by Lindsay Hill
Packet Captures are a necessary evil when you need to prove network innocence. But they’re tedious to configure, collect &amp; analyze. What if you could simplify the setup, collection and viewing? That’s what we’ve done here, combining StackStorm, Extreme Insight Architecture, CloudShark, and of course Slack.
Demo: Running Packet Captures from Slack
Check out the video here – we show entering some commands in Slack, which triggers a packet capture on multiple switches. The PCAPs are automatically uploaded to CloudShark, so we can view the packets in our browser:
Read on for more about how to set this up."><meta itemprop="datePublished" content="2018-04-27T03:54:32+00:00" />
<meta itemprop="dateModified" content="2018-04-27T03:54:32+00:00" />
<meta itemprop="wordCount" content="638">
<meta itemprop="keywords" content="networking,slack,StackStorm," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Simple Packet Captures with SLX and CloudShark"/>
<meta name="twitter:description" content="April 27, 2018
by Lindsay Hill
Packet Captures are a necessary evil when you need to prove network innocence. But they’re tedious to configure, collect &amp; analyze. What if you could simplify the setup, collection and viewing? That’s what we’ve done here, combining StackStorm, Extreme Insight Architecture, CloudShark, and of course Slack.
Demo: Running Packet Captures from Slack
Check out the video here – we show entering some commands in Slack, which triggers a packet capture on multiple switches. The PCAPs are automatically uploaded to CloudShark, so we can view the packets in our browser:
Read on for more about how to set this up."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/stackstorm.com/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        StackStorm
      
    </a>
    <div class="flex-l items-center">
      

      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://stackstorm.github.io/stackstorm.com/2018/04/26/simple-packet-captures-with-slx-and-cloudshark/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://stackstorm.github.io/stackstorm.com/2018/04/26/simple-packet-captures-with-slx-and-cloudshark/&amp;text=Simple%20Packet%20Captures%20with%20SLX%20and%20CloudShark" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://stackstorm.github.io/stackstorm.com/2018/04/26/simple-packet-captures-with-slx-and-cloudshark/&amp;title=Simple%20Packet%20Captures%20with%20SLX%20and%20CloudShark" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Simple Packet Captures with SLX and CloudShark</h1>
      
      <p class="tracked">
          By <strong>
          
              st2admin
          
          </strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2018-04-27T03:54:32Z">April 27, 2018</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p><em>April 27, 2018</em><br>
<em>by Lindsay Hill</em></p>
<p>Packet Captures are a necessary evil when you need to prove network innocence. But they’re tedious to configure, collect &amp; analyze. What if you could simplify the setup, collection and viewing? That’s what we’ve done here, combining StackStorm, Extreme Insight Architecture, <a href="https://www.cloudshark.org">CloudShark</a>, and of course Slack.</p>
<h2 id="demo-running-packet-captures-from-slack">Demo: Running Packet Captures from Slack</h2>
<p>Check out the video here – we show entering some commands in Slack, which triggers a packet capture on multiple switches. The PCAPs are automatically uploaded to CloudShark, so we can view the packets in our browser:</p>
<p>Read on for more about how to set this up.</p>
<h2 id="background-what8217s-going-on-here">Background: What’s Going on Here?</h2>
<p>There’s a few key technologies in use here:</p>
<ol>
<li><strong>Extreme Insight Architecture</strong>: the <a href="https://www.extremenetworks.com/product/slx-9850-router/">Extreme SLX series of switches</a> run a separate ‘Guest VM’ in addition to the default SLX-OS VM. This Guest VM is running Ubuntu 14.04. There is an onboard hardware path that connects the packet processor ASIC(s) to this VM. This lets us mirror data plane traffic directly to this guest VM. We can collect it in that VM, and/or copy the data elsewhere.</li>
<li><strong><a href="https://www.cloudshark.org">CloudShark</a></strong>: This is a 3rd-party service that offers “Wireshark in your browser” – upload a PCAP file, and view the packet details in your browser. They have an API for uploading PCAPs. Once a PCAP is uploaded, that file can then be shared with others. This can either run as a hosted SaaS model, or on-premises.</li>
<li><strong><a href="https://slack.com">Slack</a></strong>: IRC for hipsters, of course.</li>
</ol>
<p>Plus of course <strong>StackStorm</strong>, which is the operational ‘glue’, stitching together these elements, co-ordinating inputs, actions and outputs across our environment.</p>
<h2 id="setup-system-configuration">Setup: System Configuration</h2>
<p>Here’s the basics for how to set this up:</p>
<ol>
<li><strong>StackStorm &amp; ChatOps</strong>: <a href="https://docs.stackstorm.com/install/index.html">Install &amp; configure StackStorm</a>. Create a Slack team if you don’t already have one, and <a href="http://cloudmark.github.io/Hubot/">add a Hubot configuration</a>, and get a <code>HUBOT_TOKEN</code>. Edit the <code>/opt/stackstorm/chatops/st2chatops.env</code> file on your StackStorm server, and add that <code>HUBOT_TOKEN</code>. Set <code>HUBOT_ADAPTER=slack</code>, and restart the st2chatops service. Invite the bot to your Slack channel, and it should start responding to <code>!help</code>.</li>
<li><strong>CloudShark</strong>: You will need an account with CloudShark. You can use either the SaaS offering, or on-premises. Get a CloudShark <a href="https://support.cloudshark.org/api/">API Key</a>.</li>
<li><strong>SLX Setup</strong>: Enable the Guest VM on your SLX switches. Copy stanley’s public SSH key to <code>authorized_keys</code> on the Guest VM. Add entries to DNS or your hosts file so that you can ssh from your StackStorm server to the switches and their guest VM. Use the format <code>switch_name-tpvm</code> for the guest VM DNS entries.</li>
</ol>
<h2 id="setup-packs-workflows--aliases">Setup: Packs, Workflows &amp; Aliases</h2>
<p>Install the st2_demos pack with <code>st2 pack install https://github.com/StackStorm/st2_demos</code>. This contains the alias file <code>/opt/stackstorm/packs/st2_demos/aliases/multicap.yaml</code>, and the workflow metadata and definitions, /opt/stackstorm/packs/st2_demos/actions/multicap.yaml and <code>/opt/stackstorm/packs/st2_demos/actions/workflows/multicap.yaml</code>. You can of course edit these files, and move them to other packs.</p>
<p>Install the clicrud and CloudShark packs with <code>st2 pack install clicrud cloudshark</code>.</p>
<p>Configure the CloudShark pack with <code>st2 pack configure cloudshark</code> – you will need to use your API key from above.</p>
<p>Copy <code>/opt/stackstorm/packs/clicrud/clicrud.yaml.example</code> to <code>/opt/stackstorm/configs/clicrud.yaml</code>, and configure as required.</p>
<p>Afterwards, run <code>sudo st2ctl reload --register-all</code></p>
<h2 id="try-it-out">Try it Out!</h2>
<p>You should now be ready to test it out. From Slack, run <code>!help capture</code>.</p>
<p>If this is responding, try running a capture. Something simple like <code>multicapture 'port 179' on switches slx1,slx2</code>.</p>
<p>You can get more complicated, by adding <code>timeout=30</code> or <code>count=20</code>. If you don’t specify a timeout or count, it will use the default maximums of 300s or 100 packets.</p>
<h2 id="future-improvements">Future Improvements</h2>
<p>This workflow can be improved, and made more robust. Potential improvements include:</p>
<ul>
<li>Use ACL-based filtering on the SLX</li>
<li>Clean up old PCAPs – both those on the ST2 server, and in CloudShark</li>
<li>Modify to work by collecting packets on a server, rather than an SLX</li>
<li>Pause (or cancel) the workflow if there are other captures in progress. This could be done within the workflow itself, or by using <a href="https://docs.stackstorm.com/reference/policies.html">policies</a>.</li>
</ul><ul class="pa0">
  
   <li class="list">
     <a href="/stackstorm.com/tags/networking" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">networking</a>
   </li>
  
   <li class="list">
     <a href="/stackstorm.com/tags/slack" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">slack</a>
   </li>
  
   <li class="list">
     <a href="/stackstorm.com/tags/stackstorm" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">StackStorm</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/stackstorm.com/2018/01/25/new-year-new-stackstorm-v2-6-released/">New Year, New StackStorm – v2.6 Released</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/12/19/early-christmas-stackstorm-patch-release-2-5-1/">Early Christmas: StackStorm Patch Release 2.5.1</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/11/03/stackstorm_goes_extreme/">StackStorm goes to Extreme</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/10/26/stackstorm-2-5-hit-streets/">StackStorm 2.5 Has Hit the Streets!</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/09/04/august-pack-updates/">August Pack Updates</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/06/19/stackstorm-2-3-something-everyone/">StackStorm 2.3: Something for Everyone!</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/05/04/stackstorm-at-openstack-summit-boston-2017/">StackStorm at OpenStack Summit Boston 2017</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/04/21/official-stackstorm-docker-image-here/">Official StackStorm Docker Image is Here!</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/04/05/bugs-fixes-security-updates-st2-2-2-1/">Bugs, fixes, security updates: It’s ST2 2.2.1</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/02/27/stackstorm-2-2/">StackStorm 2.2 is up!</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/01/31/stackstorm-exchange-new-pack-management/">StackStorm Exchange: The New Pack Management</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/01/24/innovation-at-dimension-data-event-driven-automation/">Innovation at Dimension Data: Accelerating Innovation and Digital Transformation with StackStorm Event Driven Automation</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2017/01/12/event-driven-auto-remediation-elastic-stack/">Event Driven Auto-Remediation with the Elastic Stack</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2016/11/15/genomics-sequencing-stackstorm-reading-source-code-biology/">Genomics Sequencing, StackStorm, and Reading the Source Code of Biology</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/stackstorm.com/2016/11/14/iot-event-driven-automation-supercomputing16/">Unleash the power of IoT with Event-Driven Automation (ST2 &amp; BWC @ SuperComputing16)</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://stackstorm.github.io/stackstorm.com" >
    &copy;  StackStorm 2021 
  </a>
    <div>














</div>
  </div>
</footer>

  </body>
</html>
